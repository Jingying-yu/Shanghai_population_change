---
title: "WWII Events Reduce Population in One Shanghai District While Increasing It in Others"
subtitle: "Impact Analysis of Japanese Occupation on Population Shifts Across Shanghai’s Districts During WWII"
author: 
  - Sandy Yu
thanks: "Code and data are available at: https://github.com/Jingying-yu/Shanghai_population_change"
date: today
date-format: long
abstract: "This paper evaluates the impact of three historic events on the population dynamics of Shanghai during WWII: the Japanese occupation of the Chinese-administered area, France’s surrender in WWII, and the Japanese occupation of the International Settlement. Data from the Virtual Shanghai research platform and historic publications are analyzed using a difference-in-difference model to estimate the effects of these events. The results indicate that the Japanese occupation of the Chinese-administered area led to an overall increase in Shanghai’s population across all districts. In contrast, France’s surrender during WWII had a negative impact on population numbers in all districts except the French Concession. Similarly, the Japanese occupation of the International Settlement caused population declines in all districts except the International Settlement itself. These findings underscore the complex demographic shifts resulting from geopolitical events and reveal how wartime occupation reshaped urban populations in uneven ways, reflecting resilience and displacement patterns."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(arrow)
library(readr)
library(knitr)
library(kableExtra)
library(modelsummary)
library(rstanarm)
library(dplyr)
library(broom.mixed)
```

```{r}
#| include: false
#| warning: false
#| message: false

calibration_percent <- read_parquet(file = here::here("data/02-analysis_data/calibration_percent.parquet"))
year_refugee_summary <- read_parquet(file = here::here("data/02-analysis_data/year_refugee_summary.parquet"))
combined_data <- read_parquet(file = here::here("data/02-analysis_data/combined_data.parquet"))
model_format <- read_parquet(file = here::here("data/02-analysis_data/model_format.parquet"))
did_model <- readRDS(file = here::here("models/did_model.rds"))
```

# Introduction


Overview paragraph

Estimand paragraph

Results paragraph

Why it matters paragraph

Analyses and findings in this paper are structured into several sections: @sec-data -- Data, @sec-model – Model, @sec-results -- Results, and @sec-discussion -- Discussion. The Data section examines all variables and attributes kept for analysis, followed by an explanation of their measurement and purpose. The Model section defines the generalized linear model used for further analysis, explain its components, and presents model justifications. The Result section focuses on visualizing and presenting the model results through data presented in Data section. The Discussion section further evaluate the interpretations behind the model results presented in the previous section, and touches on any expanded topics as well as weaknesses and next steps.

# Data {#sec-data}

## Overview

Data is cleaned and analyzed using the open-source statistical programming language R [@citeR] and supporting packages including tidyverse [@tidyverse], arrow [@arrow], readr [@readr], knitr [@knitr], kableExtra [@kableExtra], modelsummary [@modelsummary], rstanarm [@rstanarm], dplyr [@dplyr], and broom.mixed [@broom.mixed]. These tools facilitate data manipulation, visualization, modeling, and reporting. Detailed descriptions of each dataset are provided in the subsections below.

## Data Sources

-   talk about where the data in my primary reference book is gathered
-   mentions the credibility of source and instability of recording instrument & methodology

## Historical Background

Place: Shanghai, China

When: 1936-1942

Who: Chinese population in Shanghai

Define: 1. give 1-2 sentence broad overview of China's state of unrest 2.THREE districts in Shanghai: Chinese District, International Settlement, French Concession - who controlled each district and the level of governance each authority have in comparison to Chinese government 3.Outline area (%) of each district (do not get into specifics, put that in Results section)

Important Event Timeline

1\. 1937-08-13: Japanese armed forces entered Shanghai

2\. 1937-11-12: Japanese armed forces claims occupation of Shanghai --\> ends Chinese district

1940-06-22: France surrendered to Germany --\> French Concession stopped taking refugees

3\. 1942-01: Japanese armed forces claims authority over International Settlement (which was mainly under the governance of U.K and U.S prior to this date)

4\. 1945-08-15: Japan surrendered in WWII

5\. 1945-10: most Japanese armed forces withdrew from Shanghai

## Measurement & Methodology

-   how population is recorded
-   Why choose 1936 - 1942 (ex. if an event occurred in Nov of 1937, would I take values of 1937 as a variable for prior to event occurrence or after?)

Survey Difficulties - Population Volatility caused by Warfare: Population is extreme volatile within this time period, population shifts constantly as 战况 proceed - Regional Recording Limitations: Survey response collect difficulty varies between districts. - Resistance due to Political Risk

## Variables of Interest

```{r}
#| echo: false
#| eval: true
#| label: tbl-outcome_variable
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false
#| message: false

knitr::kable(combined_data, col.names = c("Year", "Pop CHN District", "Pop IS", "Pop FC"), align = c("c", "c", "c", "c"))
```

### Outcome variable

-   outcome variable is *population*

### Predictor variables

Time variable: year Observations used in modelling and other analysis in this paper is ranged between 1936 to 1942. No observation is selected before 1936 as the growth pattern varies significantly from the event of our interest (Japanese occupation of Shanghai's different districts), and no value is elected beyond 1942 due to data constraints. No annual population records exists on a district bases beyond 1942. Foreign districts 解散 in 1949 as new political party came to power and the People's Republic of China was declared.

#### Binary Indicators

District indicators: - Variable *district_is* abd *district_fc* are two binary variable used to indicate the district identity of an observation. There are 3 possible district identity in Shanghai during 1930s-40s: Chinese-administrated District, International Settlement, and French Concession.

The Chinese-administrated District is governed by local Chinese authority. Land type in this area is primary rural, most of the local population are farmers. Percentage of foreign (out-of-province) immigrants or refugees is low. (@sh) In this analysis paper, Chinese-administrated District takes value of *district_is = 0* and *district_fc = 0* (it is neither International Settlement nor French Concession).

The International Settlement district is a generalized term for section of lands that allowed the occupation of foreign (non-Chinese) residence. Foreigners in Shanghai were not allow to reside in areas outside of the bounds of this district. Governance power of foreign population within the district -- including the policing, taxing, etc, are transferred to foreign authorities. This district takes up most of the central-city in Shanghai during the 1930s-40s, with foreign investment attracting many business opportunities and subsequently job opportunities. Due to the complicated political authorities within the district, the part of Shanghai remains initially untouched by the Japanese forces as the entered Shanghai's Chinese-administrated District. International Settlement district takes the value of *district_is = 1* and *district_fc = 0* in this paper.

French Concession district is a land district given solely to the French. French residency are given the authorization to self-govern within this area. Due to political reasons on the Western battlefield, this district remains untouched by the Japanese forces all the way until they withdrew from Shanghai. The French Concesion district takes value of *district_is = 0* and *district_fc = 1* for all analysis in the paper.

Historic Event indicators: - *cd_occupied*, *french_surrender*, and *is_occupied* are binary variables that mark the whether or not a major historic event that may have impacted Shanghai's population during the observation period (1936-1942) has occured yet. 1. The Japanese armed forces declared occupation of the Chinese-administrated district on 1937-11-12. With expectation that Shanghai's population will internally shift out of the Chinese-administrated district, the binary variable *cd_occupied* is used to measure the impact of this event on the population change in Shanghai. 2. As WWII impacted the Eastern globe, on the primary battlefield (Western Battlefield), France surrendered to Germany on 22 June 1940. Since Japan sided with Germany in WWII, France's whiteflagging to Germany led to Shanghai's Japanese forces promising not to invade the French Concession on the condition that the district stop taking refugees and support Japanese governance. The paper uses the binary variable *french_surrender* to evaluate the impact this event has on the overall population in Shanghai. 3. In January of 1942, the Japanese forces occupied the International Settlement. Local authority handed over its governing power to the invading forces. This event's impact on Shanghai's population is measuring using the binary variable *is_occupied*.

```{r}
#| echo: false
#| eval: true
#| label: tbl-d_variables
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false
#| message: false

# Select the rows you want
sliced_table <- model_format |>
  select(year, population, district_is, district_fc, cd_occupied, french_surrender, is_occupied) |>
  slice(c(3, 4, 8, 15, 16, 20))

knitr::kable(sliced_table, col.names = c("Year", "Population", "district_is", "district_fc", "cd_occupied", "french_surrender", "is_occupied"), align = c("c", "c", "c", "c", "c", "c", "c"))

```

# Model

The goal of our modelling strategy is to evaluate the impact of 2 historical events in Shanghai during WWII.

Here we briefly describe the Difference-in-Difference analysis model used to investigate the impact of the Japanese forces taking over the Chinese district and International Settlement in November 1937 and December 1941 on population shift between different Districts in Shanghai.

Background details and diagnostics are included in Appendix [@sec-model-details].

## Model set-up

$$y_i|\mu_i, \sigma \sim \text{Normal}(\mu_{i,t}, \sigma)$$

$$\mu_i = \alpha + \beta_k$$
$$\alpha \sim \text{Normal}(0, 2.5)$$

$$\beta_k \sim \text{Normal}(0, 2.5) \quad \text{for } k = 1, ..., 12$$

$$\sigma \sim \text{Exponential}(1)$$

**Where**:

-   $y_i$: Observed population in district i at year t.
-   $\alpha$: The intercept for when all variables take value of 0.
-   $\beta_1$: coefficient for temporal observation *year*. Controls for the effect of time (on an annual basis) on Shanghai's population.
-   $\beta_2$: coefficient for the dummy variable *district_is*. Take on value of 1 if the district of the observation is International Settlement districts (1 if *district type* is IS, 0 otherwise). The coefficient measures the effect of district identity on population of Shanghai within a given year.
-   $\beta_3$: *district_fc*: Dummy variable for French Concession districts (1 if $i$ is FC, 0 otherwise). The coefficient measures the effect of district identity on population of Shanghai within a given year.
-   $\beta_4$: the coefficient for *cd_occupied* indicator. This indicator takes a value of 1 after the Chinese-administered district was occupied by Japanese forces in year 1937 (1 if $t \geq 1937$, 0 otherwise). The coefficient measures the effect of this indicator on population of Shanghai within a given year.
-   $\beta_5$: coefficient for indicator *french_surrender* which takes on a value of *1* after the French Surrendering to Germany in 1940, leading to the French Concession rejecting refugees in Shanghai (1 if $t \geq 1940$, 0 otherwise). The coefficient measures the effect of this indicator on population of Shanghai within a given year.
-   $\beta_6$: the coefficient for the indicator *is_occupied*. This indicator marks the Japanese occupation of the International Settlement in 1942 (1 if $t \geq 1942$, 0 otherwise). The coefficient measures the effect of this indicator on population of Shanghai within a given year.
-   $\beta_i\ where\ i = 7, ..., 12$: coefficients for interaction terms below. Each term ajusts the impact of a historical events on a district-specific basis.


**Interaction Terms**:

The interaction terms in the model are essential because they capture how the impact of historical events (e.g., the 1937 occupation of Chinese-administered districts, the 1940 refugee rejection in the French Concession, and the 1942 occupation of the International Settlement) varies across different district types. By including interactions between event indicators and district types, the model accounts for district-specific responses to each event, controlling for the fact that the effect of an event on population changes may not be uniform across all districts. For instance, the 1937 occupation might lead to population declines in Chinese-administered districts but population increases in the International Settlement due to refugee influx. These terms ensure that the model can differentiate and estimate the unique effects of each event within each district type, thereby improving precision and interpretability.

-   *district_is × cd_occupied*: Captures the effect of the 1937 occupation on the International Settlement in comparison to the Chinese-administered district (base district).
-   *district_fc × cd_occupied*: Captures the effect of the 1937 occupation on the French Concession in comparison to the base district.
-   *district_is × french_surrender*: Effect of the 1940 refugee rejection on the International Settlement.
-   *district_fc × french_surrender*: Effect of the 1940 refugee rejection on the French Concession.
-   *district_is × is_occupied*: Effect of the 1942 occupation on the International Settlement.
-   *district_fc × is_occupied*: Effect of the 1942 occupation on the French Concession.

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.

### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.



# Results

-   Data Trend Visualization

```{r}
#| label: fig-pop
#| fig-cap: Population in Shanghai between 1936 - 1942
#| echo: false
#| warning: false
#| message: false

# Create the bar chart with a trend line
ggplot(model_format, aes(x = year, y = population, fill = district_type, color = district_type)) +
  geom_bar(stat = "identity", position = "dodge", alpha = 0.7) +  # Bar chart with transparency
  geom_line(aes(group = district_type), size = 1) +  # Add trend line
  geom_point(size = 2) +  # Add points on the trend line
  scale_fill_brewer(palette = "Paired") +  # Use ColorBrewer palette for fill
  scale_color_brewer(palette = "Paired") +  # Use ColorBrewer palette for trend line
  labs(
    title = "Population In Shanghai between 1936-1942",
    x = "Year",
    y = "Population",
    fill = "District Type",
    color = "District Type"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    text = element_text(size = 12),
    plot.title = element_text(hjust = 0.5)
  )
```

-   Model results are summarized in @tbl-modelresults in Appendix (@sec-model-details).

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Extract coefficients and statistics as a data frame
model_summary <- broom.mixed::tidy(did_model)
```

#### District Impact on Population

```{r}
#| echo: false
#| eval: true
#| label: tbl-district
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false


# Filter for the specific coefficient you want (e.g., "cd_occupied")
d_types <- model_summary |>
  filter(term %in% c("(Intercept)", "district_is", "district_fc")) |>
  mutate(
    estimate = round(estimate, 2),
    std.error = round(std.error, 2))


knitr::kable(d_types, col.names = c("Parameters", "Estimated Effect", "Standard Error"), align = c("c", "c", "c"))
```

#### Historical Events

```{r}
#| echo: false
#| eval: true
#| label: tbl-events
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false


# Filter for the specific coefficient you want (e.g., "cd_occupied")
event_types <- model_summary |>
  filter(term %in% c("cd_occupied", "french_surrender", "is_occupied")) |>
  mutate(
    estimate = round(estimate, 2),
    std.error = round(std.error, 2))

knitr::kable(event_types, col.names = c("Parameters", "Estimated Effect", "Standard Error"), align = c("c", "c", "c"))
```

#### Historic Events' Impact on Each District

```{r}
#| echo: false
#| eval: true
#| label: tbl-events_district
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false


# Filter for the specific coefficient you want (e.g., "cd_occupied")
impact_types <- model_summary[7:12, ] |>
  mutate(estimate = round(estimate, 2),
    std.error = round(std.error, 2))

print(impact_types)
knitr::kable(impact_types, col.names = c("Parameters", "Estimated Effect", "Standard Error"), align = c("c", "c", "c", "c", "c", "c"))
```

# Discussion

## Interpretation of the Event Impacts

### Impact of Occupation in Chinese District

### Impact of French Surrendering to Germany on Shanghai

### Impact of Occupation in International Settlement

## Reason why the French Concession was Exempted from Japanese Occupation

-   During WWII, on the European battlefield, France surrendered to Germany on June 22nd of 1940 (Check this & reference with a credible source). Since Japan was on the same side as Germany during that time, Japanese armed forces decided allow the French Concession to retain its own governance.
-   However, the French Concession is still constantly under the watch of the Japanese forces that has occupied the rest of Shanghai since 1942. 街上不得有侮辱日本的旗帜或者宣言，官方必须积极配合日本统治者进行有利于日本统治的宣传,etc.(can reference to video summary here)

## Refugees from outside of Shanghai Province

-   industrialization was not so popular back in the 1930s, many provinces are still mostly rural. But warfare messed with the land and the yields, causing many farmers to starve and ultimately have to seek refugee (find job) in industrialized city (where income is not dependent on land yield)
-   many people flooded to Shanghai for this reason (can insert calculation in data table 20 from reference book here)

### Job Oppurtunities in Shanghai

Aside from the instability caused by the Japanese armed forces, there are a few other reasons for Chinese population to move into the international settlement & French Concession. 1. Job opportunities - Heart of Shanghai city in the 1930-1940s, high pop density lead to boom of economy = more job opportunities - many factories are located with the settlements (less so in concession)

### Barrier to Entry in Job Market

2.  Barrier to Entry for certain job types

-   旧时候 -- 通讯还没有那么发达的时候，人们都很团结。那个时候同乡会的力量很强大。在外省，从同一个省来的漂泊者会互相帮扶着垄断一个城市的某种行业。例如，在旧上海，要做酒店生意的话你就必须是湖南人，给人做洗脚生意的肯定是苏北人。。。

## Instability after Japanese Occupation ends in WWII: Chinese Civil War

-   after the Japanese armed forces withdrawed from Shanghai, what follows is not recovery and rest for the local population
-   Competition for power within China's 2 political parties caused full-scale political warfare, now known as the *Chinese Civil War*
-   unlike Western political parties, Chinese political parties in the 1900s are more like parties of a throne. They each have their own ideology and an armed forces that follow. Most of all of the provinces are effected by this internal warfare, which ended in 1949 as 国民党 lost and withdrawed to Taiwan.

## Weaknesses and next steps

### Data Measurement Weaknesses

-   data was recorded during wartime, many numbers were missing
-   base unit for population records is not ppl, it is instead "household". \# of ppl in a household is estimated based on historical data
-   many people chose to not report or partially report numbers due to convience or economic reasons, data may not be accurate

### Next Steps

\newpage

\appendix

# Appendix {.unnumbered}

# Additional data details

# Model details {#sec-model-details}

## Model Summary Table

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

did_model <-
  readRDS(file = here::here("models/did_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

modelsummary::modelsummary(
  list(
    "Population model" = did_model
  ),
  statistic = "mad",
  fmt = 2,
  metrics = c("R2", "RMSE")
)
```

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows...

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

model_format <- read_parquet(file = here::here("data/02-analysis_data/model_format.parquet"))


pp_check(did_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(did_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(did_model, "trace")

plot(did_model, "rhat")
```


\newpage

# Idealized Survey Methodology

This appendix presents an idealized design for a population sampling survey, assuming that a data-recorder has unlimited time and authority to collect data within the historical timeframe of 1936–1942. The proposed methodology outlines a systematic approach to gathering detailed population data from Shanghai’s districts during pivotal wartime events, with considerations for the practical constraints and technology available during that period. While acknowledging the inherent challenges of conducting such a survey, this design aims to provide a comprehensive framework for understanding population dynamics within the Chinese-administered areas, International Settlement, and French Concession.

## Objective of the Survey

The purpose of this survey is to evaluate the relationship between key historical events and population shifts within Shanghai’s districts between 1936 and 1942. Specifically, the study aims to document the population changes in three major districts—Chinese-administered areas, International Settlement, and French Concession—during pivotal events such as the 1937 Japanese occupation of Chinese districts, the 1940 rejection of refugees in the French Concession, and the 1942 occupation of the International Settlement.

## Target Population

The survey targets residents and local representatives from the three major districts of Shanghai. These include long-term residents who were present before and during the historical events under study, as well as recent migrants and refugees arriving in these districts as a result of wartime displacement. The goal is to achieve representative coverage across the three districts to capture the diversity in population trends and movement patterns.

## Sampling Design

The sampling design employs stratified random sampling to ensure representation across the three major districts. Each district is treated as a separate stratum: Chinese-administered areas, International Settlement, and French Concession. A fixed number of households per district are selected based on district size, population density, and anticipated population shifts. Special attention is given to refugee populations within the International Settlement and French Concession to capture the impact of displacement. Enumerators use household lists and local community organizations, such as neighborhood associations and refugee aid committees, to randomly select respondents within strata.

## Recruitment Strategy

The recruitment strategy involves direct engagement with local leaders, community groups, and refugee aid organizations. Enumerators collaborate with influential figures in each district to gain trust and permission to conduct the survey. Recruitment booths are set up in public spaces such as markets and parks to engage with potential respondents. Additionally, refugee aid centers are utilized to access displaced populations. Recruitment materials are printed in both Chinese and English to accommodate the linguistic diversity of Shanghai’s residents.

## Survey Instrument

The survey instrument consists of a structured questionnaire covering demographic information, migration history, wartime impact, and population and housing details. The demographic section collects age, gender, occupation, family size, and household composition. Migration history includes the origin, year of migration to the current district, and reasons for relocation. Wartime impact focuses on displacement, property loss, and wartime experiences. Lastly, the population and housing section gathers data on the number of residents, housing type, and living conditions. Open-ended questions are also included to capture respondents’ personal narratives about wartime displacement and resettlement.

## Data Collection Procedures

Data collection occurs between 1936 and 1942, with enumerators visiting households, public spaces, and refugee shelters. Enumerators are trained to conduct interviews in Chinese, Shanghainese, or English based on respondent preferences. Responses are recorded on pre-printed forms, which are later transcribed and stored securely. To ensure accuracy, enumerators cross-check entries at the end of each survey day. Each enumerator is assigned a specific district to maintain consistency in data collection practices.

## Limitations and Challenges

Some areas, particularly those under military occupation, may not be accessible for data collection, leading to incomplete coverage. Additionally, respondents may underreport family size or migration history due to privacy concerns or fear of government reprisal. Refugee populations are often transient and may not remain in one location long enough for follow-up interviews. Despite these limitations, the survey employs robust sampling and recruitment strategies to mitigate potential biases.

## Ethical Considerations

Informed consent is obtained by informing respondents about the purpose of the survey and how their data will be used before they agree to participate. Personal identifying information is anonymized to ensure respondent privacy and security. Participation is entirely voluntary, and respondents can opt out at any time without consequences. The survey complies with ethical standards to respect the rights and dignity of all participants.

\newpage

# References
